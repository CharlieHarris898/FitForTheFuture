<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calorie Calculator</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
    <script>
        function goToHome() {
            console.log("Invoked goTohome() ");
            window.open("Home.html", "_self");
        }
        function goToExercises() {
            console.log("Invoked goToExercises() ");
            window.open("Exercises.html", "_self");
        }
        function goToRecipes() {
            console.log("Invoked goToRecipes() ");
            window.open("Recipes.html", "_self");
        }
        function goToFoodInfo() {
            console.log("Invoked goToFoodInfo() ");
            window.open("FoodInfo.html", "_self");
        }
        function goToCalories() {
            console.log("Invoked goToCalories() ");
            window.open("Calories.html", "_self");
        }
        function goToInfo() {
            console.log("Invoked goToInfo() ");
            window.open("User Information.html", "_self");
        }

        function calculateCalories(){
             console.log("Invoked calculateCalories()");

            const formData = new FormData(document.getElementById('calculatorForm'));
            var url = "/calories/get";

            fetch(url, {
                method: "POST",
                body: formData,
            }).then(response => {
                return response.json();                 //return response to JSON
            }).then(response => {
                if (response.hasOwnProperty("Error")) { //checks if response from server has a key "Error"
                    alert(JSON.stringify(response));    // if it does, convert JSON object to string and alert
                } else {
                    console.log(response.CalsPerMin);
                    let calsPerMin = response.CalsPerMin;
                    calculateFinalCalories(calsPerMin);
                }
            });
        }

        function getUserInfo() {
            console.log("Invoked getUserInfo()");

            const url = "/userinformation/getUser/";	// API method on webserver will be in Weight class with @Path of list

            fetch(url, {
                method: "GET",
            }).then(response => {
                return response.json();                 //return response to JSON
            }).then(response => {
                if (response.hasOwnProperty("Error")) { //checks if response from server has a key "Error"
                    alert(JSON.stringify(response));    // if it does, convert JSON object to string and alert
                } else {
                    console.log(response.toString());
                    fillUserForm(response);
                }
            });
        }

        function fillUserForm(data) {
            console.log("invoked fillUserForm()");

            document.getElementById("Height").innerHTML = data.Height;
            document.getElementById("Weight").innerHTML = data.Weight;
        }

        function calculateFinalCalories(CalsPerMin){
            let time = document.getElementById("time").value;
            console.log(time);

            var caloriesBurnt = CalsPerMin * time;
            console.log(caloriesBurnt);
            getUserInfo();
            console.log(document.getElementById("Height").innerHTML);
            console.log(document.getElementById("Weight").innerHTML);
            var finalCaloriesBurnt = 0;
            if (document.getElementById("Height").innerHTML > 170){
                finalCaloriesBurnt = (caloriesBurnt * 1.1);
                console.log(finalCaloriesBurnt);
            } else if(document.getElementById("Height").innerHTML < 170){
                finalCaloriesBurnt = (caloriesBurnt * 0.9);
                console.log(finalCaloriesBurnt);
            } else{
                finalCaloriesBurnt = (caloriesBurnt);
                console.log(finalCaloriesBurnt);
            }
            if (document.getElementById("Weight").innerHTML > 84){
                finalCaloriesBurnt = (finalCaloriesBurnt * 1.1);
                console.log(finalCaloriesBurnt);
            } else if(document.getElementById("Weight").innerHTML < 84){
                finalCaloriesBurnt = (finalCaloriesBurnt * 0.9);
                console.log(finalCaloriesBurnt);
            }  else{
                finalCaloriesBurnt = (caloriesBurnt);
                console.log(finalCaloriesBurnt);
            }
            finalCaloriesBurnt = finalCaloriesBurnt.toFixed(2);
             document.getElementById("finalCaloriesBurnt").innerHTML = finalCaloriesBurnt;
             addCalories(finalCaloriesBurnt);
        }

        //add record for this activity to database
         function addCalories(finalCaloriesBurnt){

            console.log("invoked addCalories()");

            const exercise = document.querySelector('input[name="Exercise"]:checked').value; //turns the radio inputs from the Calculator Form into JS values
            const intensity = document.querySelector('input[name="Intensity"]:checked').value;
            const time = document.getElementById('time').value
             const date = document.getElementById('date').value
            console.log(exercise);
            console.log(time);
            console.log(intensity);
            console.log(finalCaloriesBurnt);

            const formData = new FormData();                //turning data to a form so it can easily be inputted into API
            formData.append('exercise', exercise);
            formData.append('time', time);
            formData.append('intensity', intensity);
             formData.append('date', date);
            formData.append('caloriesBurned', finalCaloriesBurnt);

            var url = "/userexercises/add";

            fetch(url, {
                method: "POST",
                body: formData,
            }).then(response => {
                return response.json();                 //return response to JSON
            }).then(response => {
                if (response.hasOwnProperty("Error")) { //checks if response from server has a key "Error"
                    alert(JSON.stringify(response));    // if it does, convert JSON object to string and alert
                } else {
                    alert("Exercise successfully calculated");
                }
            });
        }
    </script>

</head>
<body onload="getUserInfo()">

<div id="Height" style="display: none;"></div>
<div id="Weight" style="display: none;"></div>

<div class="header">
    <button class="NavButton" id="Home" onclick='goToHome();'>Home</button>
    <button class="NavButton" id="CaloriesSelected" onclick='goToCalories();'>Calorie Calculator</button>
    <button class="NavButton" id="Info" onclick='goToInfo();'>Your Info</button>
    <img src="FitForTheFuture.png" id="LogoNav"/>
    <button class="NavButton" id="Exercises" onclick='goToExercises();'>Exercises</button>
    <button class="NavButton" id="Recipes" onclick='goToRecipes();'>Recipes</button>
    <button class="NavButton" id="FoodInfo" onclick='goToFoodInfo();'>Food Information</button>
</div>

<div id="scroll" class="mainSection">
    <h1 class="heading" style="font-size: 60px";>Calorie Calculator</h1>
    <h2 class="heading" style="font-size: 45px";> Input info here:</h2>
    <form id="calculatorForm">
        <p>Type of Exercise:</p>
        <input type="radio" id="Treadmill" name="Exercise" value="Treadmill">
        <label for="Treadmill">Treadmill (Running)</label><br>
        <input type="radio" id="Front Crawl" name="Exercise" value="Front Crawl">
        <label for="Front Crawl">Swimming (Front Crawl)</label><br>
        <input type="radio" id="Breaststroke" name="Exercise" value="Swimming (Breaststroke)">
        <label for="Breaststroke">Swimming (Breaststroke)</label><br>
        <input type="radio" id="Cycling" name="Exercise" value="Cycling">
        <label for="Cycling">Cycling</label><br>
        <input type="radio" id="Football" name="Exercise" value="Football">
        <label for="Football">Football</label><br>
        <input type="radio" id="Rowing" name="Exercise" value="Rowing">
        <label for="Rowing">Rowing</label><br>
        <input type="radio" id="Pushups" name="Exercise" value="Pushups">
        <label for="Pushups">Pushups</label><br>
        <input type="radio" id="Squats" name="Exercise" value="Squats">
        <label for="Squats">Squats</label><br>
        <input type="radio" id="Aerobics" name="Exercise" value="Aerobics">
        <label for="Aerobics">Aerobics</label><br>

        <p>Intensity:</p>
        <input type="radio" id="low" name="Intensity" value="low">
        <label for="low">Low</label><br>
        <input type="radio" id="medium" name="Intensity" value="medium">
        <label for="medium">Medium</label><br>
        <input type="radio" id="high" name="Intensity" value="high">
        <label for="high">High</label>

        <p> Enter time spent on exercise (minutes):</p>
        <input type="number"  id="time" name="time"><br>

        <p> Enter date exercise completed:</p>
        <input type="date"  id="date" name="date"><br>

    </form>
    <button onclick="calculateCalories()" onclick="showCalories()">Calculate</button>
    <h3>Calories Burnt:</h3>
    <p id="finalCaloriesBurnt"></p>
</div>
</body>
</html>